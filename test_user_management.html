<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test User Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/Kingsway/king.css">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h2><i class="bi bi-check-circle"></i> User Management System Test</h2>
            </div>
            <div class="card-body">
                <h4>Backend API Endpoints Test</h4>
                <button class="btn btn-success mb-3" onclick="testBackend()">
                    <i class="bi bi-play-fill"></i> Run All Tests
                </button>
                <div id="testResults" class="mt-3"></div>
                
                <hr>
                
                <h4>Color Scheme</h4>
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body bg-success text-white">
                                <h5>Primary: Green</h5>
                                <p class="mb-0">#198754 (Bootstrap Success)</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body" style="background-color: #FFFDD0;">
                                <h5>Secondary: Cream</h5>
                                <p class="mb-0">#FFFDD0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body" style="background-color: #FFD700;">
                                <h5>Accent: Golden Yellow</h5>
                                <p class="mb-0">#FFD700</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE_URL = '/Kingsway/api';
        
        async function apiCall(endpoint, method = 'GET', data = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };
            
            if (data) {
                options.body = JSON.stringify(data);
            }
            
            const response = await fetch(API_BASE_URL + endpoint, options);
            return await response.json();
        }
        
        async function testBackend() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="spinner-border text-success" role="status"></div> Running tests...';
            
            const tests = [
                {
                    name: 'Get All Users',
                    test: async () => {
                        const result = await apiCall('/users/index', 'GET');
                        return { success: result.success || Array.isArray(result.data), data: result };
                    }
                },
                {
                    name: 'Get All Roles',
                    test: async () => {
                        const result = await apiCall('/users/roles-get', 'GET');
                        return { success: result.success || Array.isArray(result.data), data: result };
                    }
                },
                {
                    name: 'Get All Permissions',
                    test: async () => {
                        const result = await apiCall('/users/permissions-get', 'GET');
                        return { success: result.success || Array.isArray(result.data), data: result };
                    }
                },
                {
                    name: 'Validation Helper Loaded',
                    test: async () => {
                        // Test if creating a user with invalid data returns validation errors
                        const result = await apiCall('/users/user', 'POST', {
                            username: 'ab', // Too short
                            email: 'invalid-email',
                            password: '123' // Too weak
                        });
                        return { success: !result.success && result.message, data: result };
                    }
                }
            ];
            
            let html = '<div class="list-group">';
            
            for (const test of tests) {
                try {
                    const result = await test.test();
                    const icon = result.success ? 
                        '<i class="bi bi-check-circle-fill text-success"></i>' : 
                        '<i class="bi bi-x-circle-fill text-danger"></i>';
                    
                    html += `
                        <div class="list-group-item">
                            ${icon} <strong>${test.name}</strong>
                            <pre class="mt-2 mb-0 small bg-light p-2" style="max-height: 200px; overflow: auto;">
${JSON.stringify(result.data, null, 2)}
                            </pre>
                        </div>
                    `;
                } catch (error) {
                    html += `
                        <div class="list-group-item">
                            <i class="bi bi-exclamation-triangle-fill text-warning"></i> <strong>${test.name}</strong>
                            <pre class="mt-2 mb-0 small bg-light p-2">${error.message}</pre>
                        </div>
                    `;
                }
            }
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>
